# νΈλ¬λΈ”μν…: Next.js Hydration μ—λ¬

**μ‘μ„±μΌ**: 2026-01-06
**μ—λ¬**: `Hydration failed because the server rendered HTML didn't match the client.`
**λ°μƒ μ„μΉ**: `DefaultDashboard.tsx`

---

## 1. Hydrationμ΄λ€ λ¬΄μ—‡μΈκ°€?

Next.jsμ™€ κ°™μ€ μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§(SSR) ν”„λ μ„μ›ν¬μ—μ„ **Hydration(μν™”, ζ°΄ε–)**μ€ λ§¤μ° μ¤‘μ”ν• κ°λ…μ…λ‹λ‹¤.

1.  **μ„λ²„ λ λ”λ§ (SSR)**: μ‚¬μ©μκ°€ νμ΄μ§€μ— μ²μ μ ‘μ†ν•λ©΄, μ„λ²„λ” νμ΄μ§€μ μ΄κΈ° HTMLμ„ λ―Έλ¦¬ λ§λ“¤μ–΄μ„ λΈλΌμ°μ €μ— λ³΄λƒ…λ‹λ‹¤. λ•λ¶„μ— μ‚¬μ©μλ” μ½ν…μΈ λ¥Ό λ§¤μ° λΉ λ¥΄κ² λ³Ό μ μμµλ‹λ‹¤. (λΉ λ¥Έ FCP)
2.  **μ •μ  HTML**: ν•μ§€λ§ μ„λ²„κ°€ λ³΄λ‚Έ HTMLμ€ 'μ£½μ€' μƒνƒμ…λ‹λ‹¤. λ²„νΌμ„ ν΄λ¦­ν•΄λ„ μ•„λ¬΄ λ°μ‘μ΄ μ—†κ³ , μƒνƒ λ³€κ²½λ„ μΌμ–΄λ‚μ§€ μ•μµλ‹λ‹¤.
3.  **Hydration**: λΈλΌμ°μ €κ°€ μ΄ μ •μ  HTMLκ³Ό JavaScript μ½”λ“λ¥Ό λ¨λ‘ λ‹¤μ΄λ΅λ“ν•λ©΄, Reactκ°€ μ •μ  HTML μ„μ— 'λ¬Όμ„ λ¶€μ–΄' μƒλ…μ„ λ¶μ–΄λ„£λ” κ³Όμ •μ„ μ‹μ‘ν•©λ‹λ‹¤. μ¦‰, μ΄λ²¤νΈ ν•Έλ“¤λ¬(μ: `onClick`)λ¥Ό μ—°κ²°ν•κ³ , μ»΄ν¬λ„νΈμ μƒνƒλ¥Ό μ΄κΈ°ν™”ν•μ—¬ νμ΄μ§€λ¥Ό μ™„μ „ν μƒνΈμ‘μ© κ°€λ¥ν• μƒνƒλ΅ λ§λ“­λ‹λ‹¤.

μ΄ κ³Όμ •μ΄ μ„±κ³µν•λ ¤λ©΄, **μ„λ²„κ°€ λ λ”λ§ν• HTML**κ³Ό **ν΄λΌμ΄μ–ΈνΈμ—μ„ μ²« λ λ”λ§ μ‹ μƒμ„±ν• HTML**μ΄ **μ™„λ²½ν•κ² μΌμΉ**ν•΄μ•Ό ν•©λ‹λ‹¤.

## 2. μ—λ¬ λ°μƒ μ›μΈ

Hydration μ—λ¬λ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ μ²« λ λ”λ§ κ²°κ³Όλ¬Όμ΄ λ‹¤λ¥Ό λ• λ°μƒν•©λ‹λ‹¤. `DefaultDashboard.tsx`μ—μ„ λ°μƒν• λ¬Έμ μ μ›μΈμ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

### μƒν™© λ¶„μ„

-   `DefaultDashboard` μ»΄ν¬λ„νΈλ” Redux μ¤ν† μ–΄μ `dashboardData` μƒνƒμ— λ”°λΌ λ‹¤λ¥Έ UIλ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.
    -   `dashboardData`κ°€ `null`μ΄λ©΄: **μ¤μΌλ ν†¤ UI**λ¥Ό λ λ”λ§
    -   `dashboardData`κ°€ μ΅΄μ¬ν•λ©΄: **μ‹¤μ  λ€μ‹λ³΄λ“(νμ΄ μ°¨νΈ λ“±)**λ¥Ό λ λ”λ§

### λ λ”λ§ κ²½λ΅λ³„ μ°¨μ΄μ 

#### π›¤οΈ κ²½λ΅ 1: μ„λ²„ (SSR)
1. μ‚¬μ©μκ°€ νμ΄μ§€μ— μ ‘μ†ν•©λ‹λ‹¤.
2. μ„λ²„μ—μ„ `HomePage` (Server Component)κ°€ λ λ”λ§λκ³ , `initialDashboardData`λ¥Ό κ°€μ Έμµλ‹λ‹¤.
3. μ΄ λ°μ΄ν„°λ” `HomePage.client.tsx`μ— propsλ΅ μ „λ‹¬λ©λ‹λ‹¤.
4. μ„λ²„ λ λ”λ§ κ³Όμ •μ—μ„, Client ComponentμΈ `HomePage.client.tsx`μ **`useEffect`λ” μ‹¤ν–‰λμ§€ μ•μµλ‹λ‹¤.**
5. λ”°λΌμ„ Redux μ¤ν† μ–΄λ” `dashboardData`λ΅ μ±„μ›μ§€μ§€ μ•κ³ , μ΄κΈ° μƒνƒμΈ `null`μ„ μ μ§€ν•©λ‹λ‹¤.
6. `DefaultDashboard`κ°€ λ λ”λ§λ  λ• `useAppSelector`λ” `null`μ„ λ°ν™ν•©λ‹λ‹¤.
7. **κ²°κ³Ό**: μ„λ²„λ” ν•­μƒ **μ¤μΌλ ν†¤ UI**κ°€ ν¬ν•¨λ HTMLμ„ μƒμ„±ν•μ—¬ λΈλΌμ°μ €μ— λ³΄λƒ…λ‹λ‹¤.

#### π›¤οΈ κ²½λ΅ 2: ν΄λΌμ΄μ–ΈνΈ (Hydration)
1. λΈλΌμ°μ €λ” μ„λ²„λ΅λ¶€ν„° μ¤μΌλ ν†¤ UIκ°€ λ‹΄κΈ΄ HTMLμ„ λ°›μµλ‹λ‹¤.
2. Reactλ” Hydrationμ„ μ‹μ‘ν•λ©°, μ„λ²„κ°€ ν–λ κ²ƒκ³Ό λ‘κ°™μ€ UIλ¥Ό λ§λ“¤μ–΄λ³΄λ ¤κ³  μ‹λ„ν•©λ‹λ‹¤.
3. μ΄ λ•, μ‚¬μ©μκ°€ μ΄μ „μ— λ‹¤λ¥Έ νμ΄μ§€λ¥Ό λ°©λ¬Έν–λ‹¤κ°€ λ‹¤μ‹ λμ•„μ¨ κ²½μ°, **ν΄λΌμ΄μ–ΈνΈμ Redux μ¤ν† μ–΄μ—λ” `dashboardData`κ°€ μ΄λ―Έ μ΅΄μ¬ν•  μ μμµλ‹λ‹¤.**
4. `DefaultDashboard`κ°€ λ λ”λ§λ  λ• `useAppSelector`λ” Reduxμ—μ„ `dashboardData`λ¥Ό μ¦‰μ‹ κ°€μ Έμµλ‹λ‹¤.
5. **κ²°κ³Ό**: ν΄λΌμ΄μ–ΈνΈλ” μ²« λ λ”λ§λ¶€ν„° **μ‹¤μ  λ€μ‹λ³΄λ“ UI**λ¥Ό μƒμ„±ν•λ ¤κ³  μ‹λ„ν•©λ‹λ‹¤.

### π’¥ λ¶μΌμΉ λ°μƒ!

-   **μ„λ²„κ°€ λ³΄λ‚Έ κ²ƒ**: `<Skeleton />`
-   **ν΄λΌμ΄μ–ΈνΈκ°€ κ·Έλ¦¬λ ¤λ” κ²ƒ**: `<CategoryPieChart />`

Reactλ” μ΄ λ‘μ κµ¬μ΅°κ°€ λ‹¬λΌ μ–΄λ””μ— μ΄λ²¤νΈ ν•Έλ“¤λ¬λ¥Ό λ¶™μ—¬μ•Ό ν• μ§€ μ• μ μ—†κ² λκ³ , κ²°κµ­ "Hydration failed" μ—λ¬λ¥Ό λ°μƒμ‹ν‚µλ‹λ‹¤.

## 3. ν•΄κ²° λ°©μ•: `useHydrated` ν›…

μ΄ λ¬Έμ μ ν•µμ‹¬μ€ "ν΄λΌμ΄μ–ΈνΈμ μ²« λ λ”λ§μ΄ μ„λ²„μ™€ λ¬΄μ΅°κ±΄ κ°™λ„λ΅ λ³΄μ¥ν•λ” κ²ƒ"μ…λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄, μ»΄ν¬λ„νΈκ°€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„±κ³µμ μΌλ΅ Hydration λμ—λ”μ§€ μ—¬λ¶€λ¥Ό μ•λ ¤μ£Όλ” `useHydrated` ν›…μ„ μ‚¬μ©ν•©λ‹λ‹¤.

### ν›… μƒμ„±
**νμΌ**: `src/hooks/useHydrated.ts`
```typescript
import { useState, useEffect } from 'react';

export const useHydrated = () => {
  const [isHydrated, setIsHydrated] = useState(false);

  useEffect(() => {
    // useEffectλ” ν΄λΌμ΄μ–ΈνΈμ—μ„λ§, κ·Έλ¦¬κ³  λ§μ΄νΈ(ν•μ΄λ“λ μ΄μ…) μ΄ν›„μ— μ‹¤ν–‰λ©λ‹λ‹¤.
    setIsHydrated(true);
  }, []);

  return isHydrated;
};
```

### ν›… μ μ©
**νμΌ**: `src/components/dashboard/DefaultDashboard.tsx`
```typescript
import { useHydrated } from '../../hooks/useHydrated'; // ν›… μ„ν¬νΈ

export default function DefaultDashboard() {
    const isHydrated = useHydrated(); // ν•μ΄λ“λ μ΄μ… μƒνƒ μ¶”μ 
    const userMode = useAppSelector((state) => state.ui.userMode);
    const dashboardData = useAppSelector((state) => state.search[userMode].dashboardData);

    // ...

    // ν•μ΄λ“λ μ΄μ… μ „μ΄κ±°λ‚ λ°μ΄ν„°κ°€ μ•„μ§ λ΅λ“λμ§€ μ•μ€ κ²½μ° μ¤μΌλ ν†¤μ„ ν‘μ‹ν•©λ‹λ‹¤.
    if (!isHydrated || !dashboardData) {
        return (
            // μ¤μΌλ ν†¤ UI
        );
    }
    
    // ... μ‹¤μ  λ€μ‹λ³΄λ“ UI
}
```

### ν•΄κ²° μ›λ¦¬

1.  **μ„λ²„ λ λ”λ§**: `useHydrated`λ” μ„λ²„μ—μ„ `false`λ¥Ό λ°ν™ν•©λ‹λ‹¤. `if (!isHydrated ...)` μ΅°κ±΄μ΄ `true`κ°€ λμ–΄ **μ¤μΌλ ν†¤ UI**κ°€ λ λ”λ§λ©λ‹λ‹¤.
2.  **ν΄λΌμ΄μ–ΈνΈ μ²« λ λ”λ§ (Hydration)**: `useState(false)`μ— μν•΄ `isHydrated`λ” `false`μ…λ‹λ‹¤. `if (!isHydrated ...)` μ΅°κ±΄μ΄ `true`κ°€ λμ–΄ **μ¤μΌλ ν†¤ UI**κ°€ λ λ”λ§λ©λ‹λ‹¤.
3.  **β… μΌμΉ**: μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ κ²°κ³Όκ°€ μ™„λ²½ν μΌμΉν•μ—¬ Hydrationμ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λ©λ‹λ‹¤.
4.  **ν΄λΌμ΄μ–ΈνΈ λ‘ λ²μ§Έ λ λ”λ§**: Hydration μ§ν›„, `useHydrated` ν›…μ `useEffect`κ°€ μ‹¤ν–‰λμ–΄ `isHydrated` μƒνƒκ°€ `true`λ΅ λ³€κ²½λ©λ‹λ‹¤. μ΄λ΅ μΈν•΄ μ»΄ν¬λ„νΈκ°€ λ¦¬λ λ”λ§λ©λ‹λ‹¤.
5.  μ΄μ  `!isHydrated` μ΅°κ±΄μ΄ `false`κ°€ λκ³ , Redux μ¤ν† μ–΄μ— `dashboardData`κ°€ μλ‹¤λ©΄ **μ‹¤μ  λ€μ‹λ³΄λ“ UI**κ°€ ν™”λ©΄μ— κ·Έλ ¤μ§‘λ‹λ‹¤.

μ΄ ν¨ν„΄μ€ Hydration μ¤λ¥λ¥Ό ν•΄κ²°ν•λ” ν‘μ¤€μ μ΄κ³  μ•μ •μ μΈ λ°©λ²•μ…λ‹λ‹¤.

## 4. κΈ°νƒ€ Hydration μ—λ¬ λ°μƒ μ›μΈ

-   `new Date()`, `Math.random()`κ³Ό κ°™μ΄ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ—μ„ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μλ” μ½”λ“ μ‚¬μ©
-   `window`, `localStorage` λ“± λΈλΌμ°μ € μ „μ© APIλ¥Ό μ΅°κ±΄λ¬Έ μ—†μ΄ μ‚¬μ©
-   CSS-in-JS λΌμ΄λΈλ¬λ¦¬μ μ„λ²„ λ λ”λ§ μ„¤μ • μ¤λ¥
-   μΏΌλ¦¬ νλΌλ―Έν„°λ‚ μΏ ν‚¤ κ°’μ— λ”°λΌ UIκ°€ λ‹¬λΌμ§€λ”λ°, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ μ ‘κ·Ό λ°©μ‹μ΄ λ‹¤λ¥Έ κ²½μ°
