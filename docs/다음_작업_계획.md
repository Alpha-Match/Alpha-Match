# ğŸ“‹ ë‹¤ìŒ ì‘ì—… ê³„íš

**ì‘ì„±ì¼:** 2025-12-10
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-12-10

---

## ğŸš€ í˜„ì¬ ì™„ë£Œ ìƒí™©

### âœ… ì™„ë£Œëœ ì‘ì—… (2025-12-10)

#### 1. Batch Server ê¸°ë³¸ êµ¬ì¡° ì™„ì„±
- âœ… gRPC proto íŒŒì¼ ì‘ì„± (embedding_stream.proto, cache_service.proto)
- âœ… DB ìŠ¤í‚¤ë§ˆ ì‘ì„± (Flyway migration)
- âœ… application.yml ì„¤ì • ì™„ë£Œ
- âœ… build.gradle ì˜ì¡´ì„± ì¶”ê°€ (pgvector í¬í•¨)
- âœ… Domain Entities ì „ì²´ êµ¬í˜„
  - MetadataEntity, EmbeddingEntity
  - DlqEntity, CheckpointEntity
- âœ… Repositories ì „ì²´ êµ¬í˜„ (JPA + Native Query Upsert)
  - MetadataRepository, EmbeddingRepository
  - DlqRepository, CheckpointRepository
- âœ… Config í´ë˜ìŠ¤ ì „ì²´ êµ¬í˜„
  - BatchProperties, ExecutorConfig, GrpcClientConfig
- âœ… gRPC Clients ì „ì²´ êµ¬í˜„
  - EmbeddingGrpcClient (Python AI Server ì—°ë™)
  - CacheInvalidateGrpcClient (API Server ì—°ë™)

#### 2. ë¬¸ì„œí™” ì™„ì„±
- âœ… ì „ì²´ í”„ë¡œì íŠ¸ CLAUDE.md êµ¬ì¡°í™” (sample.md íŒ¨í„´)
- âœ… ë£¨íŠ¸ í”„ë¡œì íŠ¸ ë¬¸ì„œ
  - ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md
  - ë°ì´í„°_í”Œë¡œìš°.md
  - ê°œë°œ_ìš°ì„ ìˆœìœ„.md
- âœ… Batch-Server ìƒì„¸ ë¬¸ì„œ
  - í”„ë¡œì íŠ¸_êµ¬ì¡°.md
  - DB_ìŠ¤í‚¤ë§ˆ.md
  - gRPC_í†µì‹ _ê°€ì´ë“œ.md
  - Reactive_Blocking_í˜¼í•©ì „ëµ.md
  - ë™ì‹œì„±_ì œì–´.md
- âœ… ê° ì„œë²„ë³„ CLAUDE.md ìƒì„±
  - Frontend/Front-Server/CLAUDE.md
  - Backend/Api-Server/CLAUDE.md
  - Backend/Batch-Server/CLAUDE.md (ì™„ì „ ë¦¬íŒ©í† ë§)
  - Demo-Python/CLAUDE.md

#### 3. Git ì»¤ë°‹
- âœ… ê¸°ëŠ¥ë³„ë¡œ ë¬¶ì–´ì„œ ì»¤ë°‹ ì™„ë£Œ
- âœ… ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„± ì™„ë£Œ

---

## â³ ë‹¤ìŒ ì„¸ì…˜ ì‘ì—… ëª©ë¡

### ğŸ”¥ Priority 1: Python Demo Server êµ¬í˜„ (ì˜ˆìƒ 1~2ì‹œê°„)

#### ì‘ì—… ë‚´ìš©
1. **Proto íŒŒì¼ ì»´íŒŒì¼**
   ```bash
   cd Demo-Python
   python -m grpc_tools.protoc -I src/proto --python_out=src/proto --grpc_python_out=src/proto src/proto/embedding_stream.proto
   ```

2. **gRPC ì„œë²„ êµ¬í˜„**
   - íŒŒì¼: `src/grpc_server.py`
   - ê¸°ëŠ¥:
     - pkl íŒŒì¼ ë¡œë”©
     - Chunk ë‹¨ìœ„ ë¶„í• 
     - gRPC Streaming ì „ì†¡
     - Checkpoint ì§€ì›

3. **í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±**
   - íŒŒì¼: `src/create_test_data.py`
   - 10,000ê°œ ë ˆì½”ë“œ
   - 1536ì°¨ì› ë²¡í„°
   - ì•½ 60MB pkl íŒŒì¼

4. **ì‹¤í–‰ ë° ê²€ì¦**
   ```bash
   # í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
   python src/create_test_data.py

   # ì„œë²„ ì‹¤í–‰
   python src/grpc_server.py
   ```

#### ì°¸ê³  ë¬¸ì„œ
- `/Demo-Python/CLAUDE.md`
- `/Backend/Batch-Server/docs/gRPC_í†µì‹ _ê°€ì´ë“œ.md`

---

### ğŸ”¥ Priority 2: Batch Server Application Services êµ¬í˜„ (ì˜ˆìƒ 3~4ì‹œê°„)

#### 1. StreamingService.java
**ìœ„ì¹˜:** `src/main/java/com/alpha/backend/application/StreamingService.java`

**ì—­í• :**
- gRPC Stream ìˆ˜ì‹  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- Checkpoint ì¡°íšŒ
- ChunkProcessor í˜¸ì¶œ
- ì „ì²´ í”Œë¡œìš° ê´€ë¦¬

**ì£¼ìš” ë©”ì„œë“œ:**
```java
public Mono<Void> processEmbeddingStream();
private Mono<Void> processChunk(RowChunk chunk);
```

**ì°¸ê³  ë¬¸ì„œ:**
- `/Backend/Batch-Server/docs/Reactive_Blocking_í˜¼í•©ì „ëµ.md`
- `/Backend/Batch-Server/docs/gRPC_í†µì‹ _ê°€ì´ë“œ.md`

#### 2. ChunkProcessor.java
**ìœ„ì¹˜:** `src/main/java/com/alpha/backend/application/ChunkProcessor.java`

**ì—­í• :**
- RowChunk â†’ Metadata/Embedding ë¶„ë¦¬
- Repositoryë¥¼ í†µí•´ Upsert
- DLQ ì²˜ë¦¬ (ì‹¤íŒ¨ ì‹œ)
- Checkpoint ì—…ë°ì´íŠ¸

**ì£¼ìš” ë©”ì„œë“œ:**
```java
public void processChunk(RowChunk chunk);
private MetadataEntity toMetadata(RecruitRow row);
private EmbeddingEntity toEmbedding(RecruitRow row);
private void saveToDLQ(RecruitRow row, Exception e);
```

**ì°¸ê³  ë¬¸ì„œ:**
- `/Backend/Batch-Server/docs/DB_ìŠ¤í‚¤ë§ˆ.md`
- `/Backend/Batch-Server/docs/ë™ì‹œì„±_ì œì–´.md`

#### 3. CacheSyncService.java
**ìœ„ì¹˜:** `src/main/java/com/alpha/backend/application/CacheSyncService.java`

**ì—­í• :**
- ìºì‹œ ë™ê¸°í™”
- API Serverì— ìºì‹œ ë¬´íš¨í™” ìš”ì²­
- ì¬ì‹œë„ ë¡œì§

**ì£¼ìš” ë©”ì„œë“œ:**
```java
public Mono<Void> notifyApiServer();
private Mono<Boolean> invalidateCacheWithRetry();
```

**ì°¸ê³  ë¬¸ì„œ:**
- `/Backend/Batch-Server/docs/gRPC_í†µì‹ _ê°€ì´ë“œ.md`
- `/Backend/Batch-Server/docs/ë™ì‹œì„±_ì œì–´.md`

---

### âš¡ Priority 3: í†µì‹  í…ŒìŠ¤íŠ¸ (ì˜ˆìƒ 1ì‹œê°„)

#### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **Python ì„œë²„ ì‹¤í–‰**
   ```bash
   cd Demo-Python
   python src/grpc_server.py
   ```

2. **Batch ì„œë²„ ì‹¤í–‰**
   ```bash
   cd Backend/Batch-Server
   ./gradlew bootRun
   ```

3. **í†µì‹  ê²€ì¦**
   - gRPC Stream ì—°ê²° í™•ì¸
   - Chunk ìˆ˜ì‹  ë¡œê·¸ í™•ì¸
   - DB ì €ì¥ í™•ì¸ (PostgreSQL)
   - Checkpoint ì—…ë°ì´íŠ¸ í™•ì¸

#### ì˜ˆìƒ ê²°ê³¼
```
[Python] Sent chunk 1 with 300 rows
[Python] Sent chunk 2 with 300 rows
...
[Batch] Received chunk #1 with 300 rows
[Batch] Saved 300 metadata records
[Batch] Saved 300 embedding records
[Batch] Updated checkpoint: uuid-xxx
...
```

---

### ğŸ”§ Priority 4: Spring Batch Configuration (ì˜ˆìƒ 4~5ì‹œê°„)

#### 1. Job êµ¬í˜„
**íŒŒì¼:** `src/main/java/com/alpha/backend/batch/job/EmbeddingBatchJob.java`

**êµ¬ì„±:**
- Job: EmbeddingBatchJob
- Step 3ê°œ:
  1. ReceiveStep: Stream ìˆ˜ì‹ 
  2. ProcessStep: ë°ì´í„° ì²˜ë¦¬
  3. NotifyStep: ìºì‹œ ë¬´íš¨í™”

#### 2. Step êµ¬í˜„
**íŒŒì¼:**
- `src/main/java/com/alpha/backend/batch/step/ReceiveStep.java`
- `src/main/java/com/alpha/backend/batch/step/ProcessStep.java`
- `src/main/java/com/alpha/backend/batch/step/NotifyStep.java`

#### 3. Listener êµ¬í˜„
**íŒŒì¼:**
- `src/main/java/com/alpha/backend/batch/listener/JobListener.java`
- `src/main/java/com/alpha/backend/batch/listener/StepListener.java`

**ì°¸ê³  ë¬¸ì„œ:**
- Spring Batch ê³µì‹ ë¬¸ì„œ
- `/Backend/Batch-Server/docs/Batchì„¤ê³„ì„œ.md`

---

### ğŸ“… Priority 5: BatchScheduler (ì˜ˆìƒ 1ì‹œê°„)

**íŒŒì¼:** `src/main/java/com/alpha/backend/scheduler/BatchScheduler.java`

**ê¸°ëŠ¥:**
```java
@Scheduled(cron = "${batch.scheduler.cron}")
public void runEmbeddingBatch() {
    // Job ì‹¤í–‰
}
```

**ì„¤ì • (application.yml):**
```yaml
batch:
  scheduler:
    enabled: true
    cron: "0 0 2 * * ?"  # ë§¤ì¼ ìƒˆë²½ 2ì‹œ
```

---

## ğŸ“Š ì „ì²´ ì§„í–‰ë¥ 

### Phase 1: gRPC í†µì‹  ê²€ì¦ (í˜„ì¬ ë‹¨ê³„)
- [x] Batch Server ê¸°ë³¸ êµ¬ì¡° ì„¤ê³„ ë° êµ¬í˜„ âœ…
- [x] Proto íŒŒì¼ ì‘ì„± âœ…
- [x] gRPC Client êµ¬í˜„ âœ…
- [x] Domain Layer êµ¬í˜„ âœ…
- [x] Config ì„¤ì • âœ…
- [ ] ğŸ”„ Python Demo Server êµ¬í˜„ (ë‹¤ìŒ ì‘ì—…)
- [ ] â³ Application Services êµ¬í˜„
- [ ] â³ Batch Job/Step êµ¬ì„±
- [ ] â³ í†µì‹  í…ŒìŠ¤íŠ¸ (Python â†” Batch)
- [ ] â³ ê°„ë‹¨í•œ ë°ì´í„° ìˆ˜ì‹ /ì €ì¥ ê²€ì¦

**ì§„í–‰ë¥ :** 60% (6/10 ì™„ë£Œ)

---

## ğŸ¯ ì¶”ì²œ ì‘ì—… ìˆœì„œ

### Day 1 (ë‹¤ìŒ ì„¸ì…˜)
1. **Python Demo Server êµ¬í˜„** (1~2ì‹œê°„)
   - Proto ì»´íŒŒì¼
   - gRPC ì„œë²„ êµ¬í˜„
   - í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±

2. **Application Services êµ¬í˜„** (3~4ì‹œê°„)
   - StreamingService
   - ChunkProcessor
   - CacheSyncService

3. **í†µì‹  í…ŒìŠ¤íŠ¸** (1ì‹œê°„)
   - Python â†” Batch ì—°ê²° ê²€ì¦
   - ë°ì´í„° ì €ì¥ í™•ì¸

**ì˜ˆìƒ ì†Œìš”:** 5~7ì‹œê°„

### Day 2
1. **Spring Batch Configuration** (4~5ì‹œê°„)
   - Job, Step, Listener êµ¬í˜„

2. **BatchScheduler** (1ì‹œê°„)

3. **í†µí•© í…ŒìŠ¤íŠ¸** (2ì‹œê°„)

**ì˜ˆìƒ ì†Œìš”:** 7~8ì‹œê°„

---

## ğŸ“ ì‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­

### 1. Reactive + Blocking í˜¼í•©
```java
// âš ï¸ ì£¼ì˜: publishOnìœ¼ë¡œ Scheduler ì „í™˜ í•„ìˆ˜!
flux.publishOn(jpaScheduler)
    .flatMap(chunk -> saveToDb(chunk))
```

### 2. Upsert ìˆœì„œ
```java
// âš ï¸ ì£¼ì˜: metadata â†’ embedding ìˆœì„œ (FK ì œì•½)
metadataRepository.upsertAll(metadataList);
embeddingRepository.upsertAll(embeddingList);
```

### 3. ìºì‹œ ë¬´íš¨í™” ì¤‘ë³µ ë°©ì§€
```java
// âš ï¸ ì£¼ì˜: AtomicBoolean ì‚¬ìš©
if (invalidating.compareAndSet(false, true)) {
    // ìºì‹œ ë¬´íš¨í™”
}
```

### 4. Python .pkl íŒŒì¼
- **ì ˆëŒ€ ì§ì ‘ ë¡œë“œí•˜ì§€ ë§ ê²ƒ!**
- ìš©ëŸ‰ì´ í¬ë¯€ë¡œ gRPC Streamingìœ¼ë¡œë§Œ ì ‘ê·¼

---

## ğŸ”— í•µì‹¬ ì°¸ê³  ë¬¸ì„œ

### ë¹ ë¥¸ ì°¸ì¡°
- **ì „ì²´ êµ¬ì¡°**: `/docs/ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md`
- **ë°ì´í„° í”Œë¡œìš°**: `/docs/ë°ì´í„°_í”Œë¡œìš°.md`
- **ê°œë°œ ìš°ì„ ìˆœìœ„**: `/docs/ê°œë°œ_ìš°ì„ ìˆœìœ„.md`

### Batch Server ìƒì„¸
- **í”„ë¡œì íŠ¸ êµ¬ì¡°**: `/Backend/Batch-Server/docs/í”„ë¡œì íŠ¸_êµ¬ì¡°.md`
- **DB ìŠ¤í‚¤ë§ˆ**: `/Backend/Batch-Server/docs/DB_ìŠ¤í‚¤ë§ˆ.md`
- **gRPC í†µì‹ **: `/Backend/Batch-Server/docs/gRPC_í†µì‹ _ê°€ì´ë“œ.md`
- **Reactive + Blocking**: `/Backend/Batch-Server/docs/Reactive_Blocking_í˜¼í•©ì „ëµ.md`
- **ë™ì‹œì„± ì œì–´**: `/Backend/Batch-Server/docs/ë™ì‹œì„±_ì œì–´.md`

### Demo Python
- **Python Server**: `/Demo-Python/CLAUDE.md`

---

## ğŸ’¡ Tip

### ì‘ì—… ì‹œì‘ ì „ í™•ì¸ ì‚¬í•­
1. âœ… PostgreSQL ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
2. âœ… pgvector extension ì„¤ì¹˜ í™•ì¸
3. âœ… Python 3.11+ ì„¤ì¹˜ í™•ì¸
4. âœ… Java 21 ì„¤ì¹˜ í™•ì¸

### ë””ë²„ê¹… íŒ
```yaml
# application.yml - ë¡œê·¸ ë ˆë²¨ ì¡°ì •
logging:
  level:
    com.alpha.backend: DEBUG
    reactor.core: DEBUG
    io.grpc: INFO
```

---

**ë‹¤ìŒ ì„¸ì…˜ì— ì´ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ì–´ì£¼ì„¸ìš”!** ğŸ“–
