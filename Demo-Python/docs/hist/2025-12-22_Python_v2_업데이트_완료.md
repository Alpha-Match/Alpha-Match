# Python ì„œë²„ v2 ì—…ë°ì´íŠ¸ ì™„ë£Œ

**ë‚ ì§œ:** 2025-12-22
**ëª©ì :** Python ì„œë²„ë¥¼ v2 ìŠ¤í‚¤ë§ˆë¡œ ì—…ë°ì´íŠ¸í•˜ì—¬ Java Batch Server v2ì™€ í˜¸í™˜

---

## ğŸ“‹ ë³€ê²½ ì‚¬í•­ ìš”ì•½

### 1. Proto íŒŒì¼ ì—…ë°ì´íŠ¸
- Java Batch Serverì˜ `embedding_stream.proto` ë³µì‚¬
- Python Proto stub ì¬ìƒì„±
- **ë³€ê²½ì‚¬í•­:**
  - RecruitRow: 6 í•„ë“œ â†’ 11 í•„ë“œ í™•ì¥
  - ë²¡í„° ì°¨ì› í†µì¼: 384d (ì „ì—­)
  - ìƒˆ ë©”ì‹œì§€: IngestMetadata, IngestDataRequest, IngestDataResponse

### 2. Domain Models v2 ì—…ë°ì´íŠ¸

#### RecruitData (v1: 6 í•„ë“œ â†’ v2: 11 í•„ë“œ)
```python
class RecruitData(BaseData):
    position: str                           # ì‹ ê·œ
    company_name: str
    experience_years: Optional[int]         # int â†’ Optional[int] (null ì§€ì›)
    primary_keyword: Optional[str]
    english_level: Optional[str]
    published_at: Optional[str]             # ì‹ ê·œ
    skills: List[str]                       # ì‹ ê·œ
    long_description: Optional[str]         # ì‹ ê·œ
    description_lang: Optional[str]         # ì‹ ê·œ
    skills_vector: List[float]              # 384d
```

#### CandidateData
- `vector` â†’ `skill_vector` (í•„ë“œëª… í†µì¼)
- ë²¡í„° ì°¨ì›: 768d â†’ 384d

#### SkillEmbeddingDicData
- `vector` â†’ `skill_vector` (í•„ë“œëª… í†µì¼)
- ë²¡í„° ì°¨ì›: 768d â†’ 384d

### 3. ì „ì²˜ë¦¬ ë¡œì§ êµ¬í˜„ (`loaders.py`)

#### PklChunkLoader._preprocess_recruit_data() ì¶”ê°€

**5ë‹¨ê³„ ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸:**
1. **ì»¬ëŸ¼ëª… ë§¤í•‘** (Title Case â†’ snake_case)
   ```python
   'Position' â†’ 'position'
   'Company Name' â†’ 'company_name'
   'Exp Years' â†’ 'experience_years'
   'skill_vector' â†’ 'skills_vector'
   # ... ì´ 15ê°œ ì»¬ëŸ¼ ë§¤í•‘
   ```

2. **Exp Years ì „ì²˜ë¦¬**
   ```python
   'no_exp' â†’ None
   '5y' â†’ 5 (Integer)
   NaN â†’ None
   ```

3. **ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ ì‚­ì œ**
   ```python
   ['__index_level_0__', 'normalized_skills',
    'embedding_input_text', 'embedding_sample']
   ```

4. **skills ë¹ˆ ë°°ì—´ í•„í„°ë§**
   - numpy array ì§€ì› ì¶”ê°€
   - ë¹ˆ ë°°ì—´ ì œì™¸ (ì‹¤ì œ í•„í„°ë§: ~0%)

5. **ë²¡í„° ëˆ„ë½ í–‰ í•„í„°ë§**
   - null vector ì œì™¸ (~7% í•„í„°ë§)

#### Numpy Array â†’ Python List ë³€í™˜
```python
# Pydantic í˜¸í™˜ì„±ì„ ìœ„í•´ ndarrayë¥¼ listë¡œ ë³€í™˜
record['skills'] = record['skills'].tolist()
record['skills_vector'] = record['skills_vector'].tolist()

# NaNì„ Noneìœ¼ë¡œ ë³€í™˜
for key, value in record.items():
    if isinstance(value, float) and pd.isna(value):
        record[key] = None
```

### 4. Skill Embeddings ì „ìš© ë¡œë” ìƒì„±

**ì‹ ê·œ íŒŒì¼:** `src/infrastructure/skill_dic_loader.py`

**ê¸°ëŠ¥:**
- JSON ì „ìš© ë¡œë” (skill_embeddings.json)
- synonyms í•„ë“œ ì œì™¸ (table_specification.md ìš”êµ¬ì‚¬í•­)
- í•„ë“œëª… ë§¤í•‘: name â†’ skill, category â†’ position_category

```python
def load_skill_embeddings_json(file_path: str) -> List[SkillEmbeddingDicData]:
    skill_list = [
        SkillEmbeddingDicData(
            skill=item['name'],
            position_category=item['category'],
            skill_vector=item['vector']
            # synonyms í•„ë“œëŠ” ì˜ë„ì ìœ¼ë¡œ ì œì™¸
        )
        for item in raw_data
    ]
    return skill_list
```

### 5. gRPC Client ì œë„¤ë¦­ ì§€ì›

**ë³€ê²½:** `List[RecruitData]` â†’ `List[BaseData]`

**ë²¡í„° í•„ë“œ ìë™ ê°ì§€:**
```python
# ë„ë©”ì¸ë³„ ë²¡í„° í•„ë“œëª… í™•ì¸
if hasattr(first_row, 'skills_vector'):
    vector_field = first_row.skills_vector
elif hasattr(first_row, 'skill_vector'):
    vector_field = first_row.skill_vector
elif hasattr(first_row, 'vector'):  # legacy v1 ì§€ì›
    vector_field = first_row.vector
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### Test 1: Recruit Data Preprocessing Pipeline âœ…

**íŒŒì¼:** `data/recruitment_v1.pkl`

**ê²°ê³¼:**
- ì´ í–‰ ìˆ˜: 93,675 â†’ 87,488 (ì „ì²˜ë¦¬ í›„)
- experience_years null: 1.93% (no_exp ë³€í™˜)
- ë²¡í„° ì°¨ì›: 384d âœ…
- skills ë°°ì—´: ë¹„ì–´ìˆì§€ ì•ŠìŒ âœ…
- Pydantic ê²€ì¦: í†µê³¼ âœ…

**í•„í„°ë§ í†µê³„:**
- Empty skills: ~0%
- Null vectors: ~7% (6,187 rows)
- **ìµœì¢… ìœ íš¨ í–‰:** 87,488 rows

### Test 2: Skill Embeddings JSON Loader âœ…

**íŒŒì¼:** `data/skill_embeddings.json`

**ê²°ê³¼:**
- ì´ ìŠ¤í‚¬: 105ê°œ
- ë²¡í„° ì°¨ì›: 384d âœ…
- synonyms í•„ë“œ ì œì™¸: âœ…
- Pydantic ê²€ì¦: í†µê³¼ âœ…

**ì¹´í…Œê³ ë¦¬ ë¶„í¬:**
- Backend: 39ê°œ
- DevOps / Cloud: 21ê°œ
- Machine Learning: 16ê°œ
- Database: 14ê°œ
- Frontend: 11ê°œ
- Collaboration / Project Management: 4ê°œ

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

### ì‹ ê·œ íŒŒì¼
- `src/infrastructure/skill_dic_loader.py` (Skill Embeddings ì „ìš© ë¡œë”)
- `test_preprocessing_pipeline.py` (í†µí•© í…ŒìŠ¤íŠ¸)
- `test_preprocessing_requirements.py` (ìš”êµ¬ì‚¬í•­ ê²€ì¦)
- `test_preprocessing_debug.py` (ë””ë²„ê¹… ìŠ¤í¬ë¦½íŠ¸)
- `test_skills_type.py` (íƒ€ì… ë¶„ì„)

### ìˆ˜ì • íŒŒì¼
- `src/domain/models.py`
  - RecruitData: 6 í•„ë“œ â†’ 11 í•„ë“œ
  - CandidateData: ë²¡í„° ì°¨ì› 768d â†’ 384d
  - SkillEmbeddingDicData: ë²¡í„° ì°¨ì› 768d â†’ 384d
  - experience_years: int â†’ Optional[int]

- `src/infrastructure/loaders.py`
  - `_preprocess_recruit_data()` ì¶”ê°€ (5ë‹¨ê³„ ì „ì²˜ë¦¬)
  - numpy array â†’ list ë³€í™˜ ë¡œì§ ì¶”ê°€
  - NaN â†’ None ë³€í™˜ ë¡œì§ ì¶”ê°€

- `src/infrastructure/grpc_clients.py`
  - ì œë„¤ë¦­ íƒ€ì… ì§€ì› (BaseData)
  - ë²¡í„° í•„ë“œ ìë™ ê°ì§€

- `src/services/ingestion_service.py`
  - ë²¡í„° í•„ë“œ ìë™ ê°ì§€

- `proto/embedding_stream.proto`
  - Java v2 proto ë³µì‚¬

---

## ğŸ” ì£¼ìš” ì´ìŠˆ í•´ê²°

### Issue 1: skills ì»¬ëŸ¼ì´ numpy array
**ë¬¸ì œ:** `isinstance(x, list)` í•„í„°ë§ì´ ëª¨ë“  ë°ì´í„° ì œê±°
**í•´ê²°:** numpy array ì§€ì› ì¶”ê°€, `.tolist()` ë³€í™˜

### Issue 2: experience_years NaN ì²˜ë¦¬
**ë¬¸ì œ:** pandas NaNì´ Pydantic int í•„ë“œì— ì „ë‹¬
**í•´ê²°:**
1. NaN â†’ None ë³€í™˜ ë¡œì§ ì¶”ê°€
2. experience_years: int â†’ Optional[int]

### Issue 3: synonyms í•„ë“œ ì œì™¸
**ë¬¸ì œ:** ê¸°ì¡´ ë¡œë”ëŠ” synonyms í¬í•¨
**í•´ê²°:** ì „ìš© ë¡œë” `skill_dic_loader.py` ìƒì„±

---

## âœ… í˜¸í™˜ì„± ê²€ì¦

### Python â†” Java í˜¸í™˜ì„±

| êµ¬ë¶„ | Python | Java | ìƒíƒœ |
|------|--------|------|------|
| Proto ë²„ì „ | v2 | v2 | âœ… |
| ë²¡í„° ì°¨ì› | 384d | 384d | âœ… |
| í•„ë“œëª… | snake_case | snake_case | âœ… |
| gRPC ë©”ì‹œì§€ | IngestDataRequest | IngestDataRequest | âœ… |

### ë°ì´í„° íŒŒì¼ í˜¸í™˜ì„±

| íŒŒì¼ | í¬ë§· | í–‰ ìˆ˜ | ë²¡í„° ì°¨ì› | ìƒíƒœ |
|------|------|-------|----------|------|
| recruitment_v1.pkl | dict['data_frame'] | 93,675 â†’ 87,488 | 384d | âœ… |
| skill_embeddings.json | JSON array | 105 | 384d | âœ… |

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **í†µí•© í…ŒìŠ¤íŠ¸**
   - Python â†’ Java gRPC ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
   - ì‹¤ì œ ë°ì´í„°ë¡œ end-to-end ê²€ì¦

2. **Candidate ë„ë©”ì¸ ì „ì²˜ë¦¬**
   - Recruitê³¼ ë™ì¼í•œ íŒ¨í„´ ì ìš© (ì˜ˆì •)

3. **ì„±ëŠ¥ ìµœì í™”**
   - Chunk size íŠœë‹
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

- `/Backend/docs/table_specification.md` - ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­
- `/Demo-Python/docs/ë°ì´í„°_ì²˜ë¦¬_ê°€ì´ë“œ.md` - Chunk Loader ê°€ì´ë“œ
- `/Demo-Python/docs/gRPC_í†µì‹ _ê°€ì´ë“œ.md` - gRPC í†µì‹  ê°€ì´ë“œ
- `data_schema_compatibility_report.md` - í˜¸í™˜ì„± ë³´ê³ ì„œ

---

**ì‘ì„±ì:** Claude Code
**ìµœì¢… ì—…ë°ì´íŠ¸:** 2025-12-22
