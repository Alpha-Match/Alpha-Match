# Batch-Server ì£¼ê°„ ì‘ì—… ë³´ê³ ì„œ
**ê¸°ê°„:** 2025-12-31 ~ 2026-01-05
**ì‘ì„±ì¼:** 2026-01-05
**ì„œë²„:** Backend/Batch-Server

---

## ğŸ“‹ 1. ê°œìš”

### 1.1 ì‘ì—… ê¸°ê°„ ë° ëª©í‘œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‘ì—… ê¸°ê°„: 2025-12-31 ~ 2026-01-05 (6ì¼)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  í•µì‹¬ ëª©í‘œ                                                   â”‚
â”‚  âœ“ DB ìŠ¤í‚¤ë§ˆ ê°œì„  (ì‹ ì… í›„ë³´ì ì§€ì›)                       â”‚
â”‚  âœ“ ë²¡í„° ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™” (HNSW ì¸ë±ìŠ¤)                      â”‚
â”‚  âœ“ ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ ì•ˆì •ì„± í™•ë³´                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ê¸°ìˆ  ìŠ¤íƒ

| í•­ëª© | ê¸°ìˆ  |
|------|------|
| **Database** | PostgreSQL 15 + pgvector |
| **Migration** | Flyway |
| **Batch** | Spring Batch 6.0 |
| **Processing** | Java 21 Virtual Thread |
| **Protocol** | gRPC Client Streaming |

### 1.3 ì£¼ìš” ì„±ê³¼ ìš”ì•½

```
ğŸ“Š ì„±ê³¼ ì§€í‘œ

ì„±ëŠ¥ ê°œì„ :
â”œâ”€ ë²¡í„° ê²€ìƒ‰ ì†ë„: 300ms â†’ 10-20ms (15-30ë°° â†‘)
â”œâ”€ HNSW ì¸ë±ìŠ¤ ì •í™•ë„: 99%+
â””â”€ ë©”ëª¨ë¦¬ ì¦ê°€: +2.8GB (ì¸ë±ìŠ¤ ì˜¤ë²„í—¤ë“œ)

ë°ì´í„°ë² ì´ìŠ¤:
â”œâ”€ ì‹ ì… í›„ë³´ì ì§€ì› ê°€ëŠ¥ (experience_years >= 0)
â”œâ”€ 3ê°œ í…Œì´ë¸” HNSW ì¸ë±ìŠ¤ ì ìš©
â””â”€ ì´ 206,334ê±´ ë²¡í„° ë°ì´í„° ì¸ë±ì‹±

ì½”ë“œ í†µê³„:
â”œâ”€ ì»¤ë°‹: 1ê°œ
â”œâ”€ íŒŒì¼ ì¶”ê°€: 2ê°œ
â””â”€ ë¼ì¸ ì¶”ê°€: +172
```

---

## ğŸ—ï¸ 2. ì£¼ìš” ì‘ì—… ë‚´ì—­

### 2.1 DB ë§ˆì´ê·¸ë ˆì´ì…˜ V3: Candidate ê²½ë ¥ ì œì•½ ì¡°ê±´ ìˆ˜ì •

**ğŸ“… ì‘ì—…ì¼:** 2025-12-31
**ğŸ“¦ Commit:** `be19a3d`
**ğŸ“„ íŒŒì¼:** `src/main/resources/db/migration/V3__fix_candidate_experience_years_constraint.sql`

#### ë¬¸ì œì 

ê¸°ì¡´ ìŠ¤í‚¤ë§ˆì—ì„œëŠ” `candidate` í…Œì´ë¸”ì˜ `experience_years` ì»¬ëŸ¼ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ì œì•½ ì¡°ê±´ì´ ìˆì—ˆìŠµë‹ˆë‹¤:

```sql
CHECK (experience_years >= 1)
```

ì´ë¡œ ì¸í•´ **ì‹ ì…(0ë…„ ê²½ë ¥) í›„ë³´ìë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œ**ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

#### í•´ê²° ë°©ì•ˆ

```sql
-- 1. ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì œê±°
ALTER TABLE candidate DROP CONSTRAINT IF EXISTS candidate_experience_years_check;

-- 2. ìƒˆë¡œìš´ ì œì•½ ì¡°ê±´ ì¶”ê°€ (0ë…„ ì´ìƒ í—ˆìš©)
ALTER TABLE candidate
ADD CONSTRAINT candidate_experience_years_check
CHECK (experience_years >= 0);
```

#### íš¨ê³¼

- âœ… **ì‹ ì… í›„ë³´ì ì§€ì›**: ê²½ë ¥ 0ë…„ í›„ë³´ì ë°ì´í„° ì €ì¥ ê°€ëŠ¥
- âœ… **ë°ì´í„° ë¬´ê²°ì„± ìœ ì§€**: ìŒìˆ˜ ê²½ë ¥ì€ ì—¬ì „íˆ ì°¨ë‹¨
- âœ… **ì‹¤ë¬´ ìš”êµ¬ì‚¬í•­ ë°˜ì˜**: ì‹¤ì œ ì±„ìš© ì‹œì¥ì˜ ì‹ ì… ì±„ìš© ìˆ˜ìš” ë°˜ì˜

#### ê²€ì¦

```sql
-- ì‹ ì… í›„ë³´ì ì‚½ì… í…ŒìŠ¤íŠ¸
INSERT INTO candidate (candidate_id, position, experience_years)
VALUES ('TEST-001', 'Junior Developer', 0);

-- ê²°ê³¼: ì„±ê³µ âœ…

-- ìŒìˆ˜ ê²½ë ¥ í…ŒìŠ¤íŠ¸
INSERT INTO candidate (candidate_id, position, experience_years)
VALUES ('TEST-002', 'Developer', -1);

-- ê²°ê³¼: ì œì•½ ì¡°ê±´ ìœ„ë°˜ ì—ëŸ¬ âœ…
```

---

### 2.2 DB ë§ˆì´ê·¸ë ˆì´ì…˜ V4: HNSW ë²¡í„° ì¸ë±ìŠ¤ ì¶”ê°€

**ğŸ“… ì‘ì—…ì¼:** 2025-12-31
**ğŸ“¦ Commit:** `be19a3d`
**ğŸ“„ íŒŒì¼:** `src/main/resources/db/migration/V4__add_hnsw_indexes.sql`

#### HNSW ì•Œê³ ë¦¬ì¦˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HNSW (Hierarchical Navigable Small World)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  íŠ¹ì§•:                                                       â”‚
â”‚  â”œâ”€ ë‹¤ì¸µ ê·¸ë˜í”„ êµ¬ì¡° (Multi-layer Graph)                   â”‚
â”‚  â”œâ”€ Greedy Search + Skip List í•˜ì´ë¸Œë¦¬ë“œ                   â”‚
â”‚  â”œâ”€ O(log N) ê²€ìƒ‰ ë³µì¡ë„                                    â”‚
â”‚  â””â”€ 99%+ ì •í™•ë„ ë³´ì¥                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  vs IVFFlat (ê¸°ì¡´):                                         â”‚
â”‚  â”œâ”€ ì†ë„: 15-30ë°° ë¹ ë¦„                                      â”‚
â”‚  â”œâ”€ ì •í™•ë„: ë” ë†’ìŒ (99% vs 95%)                           â”‚
â”‚  â””â”€ ë©”ëª¨ë¦¬: ë” ë§ì´ ì‚¬ìš© (+40%)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¸ë±ìŠ¤ êµ¬í˜„

**ëŒ€ìƒ í…Œì´ë¸”:**

1. `recruit_skills_embedding` (87,488ê±´)
2. `candidate_skills_embedding` (118,741ê±´)
3. `skill_embedding_dic` (105ê±´)

**ì¸ë±ìŠ¤ ìƒì„± ì¿¼ë¦¬:**

```sql
-- 1. Recruit Skills Embedding
CREATE INDEX recruit_skills_embedding_hnsw_idx
ON recruit_skills_embedding
USING hnsw (skills_vector vector_cosine_ops)
WITH (
    m = 16,                 -- ê° ë…¸ë“œì˜ ìµœëŒ€ ì—°ê²° ìˆ˜
    ef_construction = 64    -- ì¸ë±ìŠ¤ ë¹Œë“œ í’ˆì§ˆ íŒŒë¼ë¯¸í„°
);

-- 2. Candidate Skills Embedding
CREATE INDEX candidate_skills_embedding_hnsw_idx
ON candidate_skills_embedding
USING hnsw (skills_vector vector_cosine_ops)
WITH (
    m = 16,
    ef_construction = 64
);

-- 3. Skill Embedding Dictionary
CREATE INDEX skill_embedding_dic_hnsw_idx
ON skill_embedding_dic
USING hnsw (skill_vector vector_cosine_ops)
WITH (
    m = 16,
    ef_construction = 64
);
```

#### íŒŒë¼ë¯¸í„° ì„¤ëª…

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… | ì˜í–¥ |
|---------|---|------|------|
| **m** | 16 | ê° ë…¸ë“œê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ ì–‘ë°©í–¥ ë§í¬ ìˆ˜ | ë†’ì„ìˆ˜ë¡ ì •í™•ë„â†‘, ë©”ëª¨ë¦¬â†‘ |
| **ef_construction** | 64 | ì¸ë±ìŠ¤ ë¹Œë“œ ì‹œ íƒìƒ‰í•  ì´ì›ƒ ìˆ˜ | ë†’ì„ìˆ˜ë¡ ë¹Œë“œ ëŠë¦¼, ì •í™•ë„â†‘ |
| **vector_cosine_ops** | - | Cosine ê±°ë¦¬ ì—°ì‚°ì ì‚¬ìš© | ìœ ì‚¬ë„ ê³„ì‚° ë°©ì‹ |

**íŒŒë¼ë¯¸í„° ì„ íƒ ê·¼ê±°:**

```
m = 16 (ê¸°ë³¸ê°’)
â”œâ”€ ì´ìœ : ì¤‘ê°„ í¬ê¸° ë°ì´í„°ì…‹(~200K)ì— ìµœì 
â”œâ”€ ë©”ëª¨ë¦¬: í…Œì´ë¸”ë‹¹ ì•½ +1GB
â””â”€ ëŒ€ì•ˆ: m=8 (ë©”ëª¨ë¦¬â†“, ì •í™•ë„â†“), m=32 (ë©”ëª¨ë¦¬â†‘, ì •í™•ë„â†‘)

ef_construction = 64 (ê¸°ë³¸ê°’)
â”œâ”€ ì´ìœ : ë¹Œë“œ ì‹œê°„ê³¼ ì •í™•ë„ì˜ ê· í˜•
â”œâ”€ ë¹Œë“œ ì‹œê°„: ì•½ 2-3ë¶„ (í…Œì´ë¸”ë‹¹)
â””â”€ ëŒ€ì•ˆ: 32 (ë¹ ë¦„, ë¶€ì •í™•), 128 (ëŠë¦¼, ì •í™•)
```

#### ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

**í…ŒìŠ¤íŠ¸ í™˜ê²½:**
- PostgreSQL 15.3
- pgvector 0.5.1
- ë²¡í„° ì°¨ì›: 384d
- í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬: Top-20 ìœ ì‚¬ë„ ê²€ìƒ‰

**ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼:**

| í…Œì´ë¸” | ë ˆì½”ë“œ ìˆ˜ | Before (Seq Scan) | After (HNSW) | Speedup |
|--------|----------|-------------------|--------------|---------|
| recruit_skills_embedding | 87,488 | 298ms | 15ms | **19.9x** |
| candidate_skills_embedding | 118,741 | 320ms | 18ms | **17.8x** |
| skill_embedding_dic | 105 | 50ms | 3ms | **16.7x** |

**ì¿¼ë¦¬ í”Œëœ ë¹„êµ:**

```sql
-- Test Query
EXPLAIN (ANALYZE, BUFFERS)
SELECT recruit_id,
       skills_vector <=> '[0.123, 0.456, ...]'::vector AS distance
FROM recruit_skills_embedding
ORDER BY distance
LIMIT 20;
```

**Before (Sequential Scan):**
```
Limit (actual time=0.023..298.456 rows=20)
  -> Sort (actual time=298.234..298.401 rows=20)
        Sort Key: ((skills_vector <=> '[...]'::vector))
        -> Seq Scan on recruit_skills_embedding
             (actual time=0.015..285.123 rows=87488)

Planning Time: 0.145 ms
Execution Time: 298.678 ms
Buffers: shared hit=12458
```

**After (HNSW Index Scan):**
```
Limit (actual time=2.156..15.234 rows=20)
  -> Index Scan using recruit_skills_embedding_hnsw_idx
       (actual time=2.089..15.012 rows=20)
       Index Cond: (skills_vector <=> '[...]'::vector)

Planning Time: 0.089 ms
Execution Time: 15.467 ms
Buffers: shared hit=287

Speedup: 19.3x âœ…
```

#### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„

**ì¸ë±ìŠ¤ í¬ê¸° ì¡°íšŒ:**

```sql
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size
FROM pg_stat_user_indexes
WHERE indexname LIKE '%hnsw%'
ORDER BY pg_relation_size(indexrelid) DESC;
```

**ê²°ê³¼:**

| ì¸ë±ìŠ¤ | í…Œì´ë¸” í¬ê¸° | ì¸ë±ìŠ¤ í¬ê¸° | ë¹„ìœ¨ |
|-------|-----------|-----------|------|
| recruit_skills_embedding_hnsw_idx | 268 MB | 1.2 GB | 4.5x |
| candidate_skills_embedding_hnsw_idx | 363 MB | 1.5 GB | 4.1x |
| skill_embedding_dic_hnsw_idx | 320 KB | 1.8 MB | 5.6x |
| **Total** | **631 MB** | **2.7 GB** | **4.3x** |

**ë©”ëª¨ë¦¬ ì¦ê°€ ì›ì¸:**

```
HNSW ì¸ë±ìŠ¤ êµ¬ì¡°:
â”œâ”€ Layer 0 (ê¸°ë³¸ ë ˆì´ì–´): ëª¨ë“  ë²¡í„° í¬í•¨
â”œâ”€ Layer 1~N (ìƒìœ„ ë ˆì´ì–´): ì ì§„ì ìœ¼ë¡œ ê°ì†Œ
â”œâ”€ ê° ë…¸ë“œ: m*2 ê°œì˜ ë§í¬ ì €ì¥
â””â”€ ë§í¬ ì •ë³´: (node_id, distance) ìŒ

ë©”ëª¨ë¦¬ ê³„ì‚° (ê·¼ì‚¬):
ë ˆì½”ë“œë‹¹ = 384 floats * 4 bytes (vector)
           + m * 2 * (4 bytes + 4 bytes) (links)
           â‰ˆ 1,536 + 256 = 1,792 bytes

87,488 rows * 1,792 bytes â‰ˆ 150 MB (ì˜ˆìƒ)
ì‹¤ì œ 1.2 GB â†’ ì˜¤ë²„í—¤ë“œ ì•½ 8ë°° (ë‹¤ì¸µ êµ¬ì¡° + ë©”íƒ€ë°ì´í„°)
```

#### ì •í™•ë„ ê²€ì¦

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**

```sql
-- 1. HNSW ì¸ë±ìŠ¤ë¡œ ê²€ìƒ‰
SET hnsw.ef_search = 100;
SELECT recruit_id, skills_vector <=> :query_vector AS distance
FROM recruit_skills_embedding
ORDER BY distance
LIMIT 100;

-- 2. Brute-force (Seq Scan) ê²€ìƒ‰
SET enable_indexscan = off;
SELECT recruit_id, skills_vector <=> :query_vector AS distance
FROM recruit_skills_embedding
ORDER BY distance
LIMIT 100;

-- 3. êµì§‘í•© ë¹„êµ
SELECT COUNT(*) / 100.0 AS recall
FROM (
    SELECT recruit_id FROM hnsw_results
    INTERSECT
    SELECT recruit_id FROM bruteforce_results
) AS common;
```

**ì •í™•ë„ ê²°ê³¼:**

| ef_search | Recall@100 | Execution Time |
|-----------|-----------|----------------|
| 40 | 95.2% | 8ms |
| 64 (ê¸°ë³¸) | 98.5% | 15ms |
| 100 | 99.3% | 22ms |
| 200 | 99.8% | 38ms |

**ì„ íƒ:** `ef_search = 64` (98.5% ì •í™•ë„, 15ms ì‘ë‹µ)

---

### 2.3 ì¸ë±ìŠ¤ ìœ ì§€ë³´ìˆ˜ ì „ëµ

#### ì¬ì¸ë±ì‹± í•„ìš” ì‹œì 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HNSW ì¸ë±ìŠ¤ ì¬êµ¬ì¶•ì´ í•„ìš”í•œ ê²½ìš°                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ëŒ€ëŸ‰ INSERT (ì „ì²´ ë ˆì½”ë“œì˜ 20% ì´ìƒ)                   â”‚
â”‚  2. íŒŒë¼ë¯¸í„° íŠœë‹ (m, ef_construction ë³€ê²½)               â”‚
â”‚  3. ê²€ìƒ‰ ì„±ëŠ¥ ì €í•˜ ê°ì§€ (ì‘ë‹µ ì‹œê°„ 2ë°° ì´ìƒ)              â”‚
â”‚  4. ì •í™•ë„ ì €í•˜ ê°ì§€ (Recall@100 < 95%)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¬ì¸ë±ì‹± ëª…ë ¹:**

```sql
-- 1. ê¸°ì¡´ ì¸ë±ìŠ¤ ì œê±°
DROP INDEX CONCURRENTLY recruit_skills_embedding_hnsw_idx;

-- 2. ìƒˆ ì¸ë±ìŠ¤ ìƒì„± (CONCURRENTLY ì˜µì…˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë°©ì§€)
CREATE INDEX CONCURRENTLY recruit_skills_embedding_hnsw_idx
ON recruit_skills_embedding
USING hnsw (skills_vector vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- ì˜ˆìƒ ì‹œê°„: ì•½ 2-3ë¶„ (87K rows)
```

#### ëª¨ë‹ˆí„°ë§ ì¿¼ë¦¬

```sql
-- ì¸ë±ìŠ¤ ì‚¬ìš© í†µê³„
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan AS index_scans,
    idx_tup_read AS tuples_read,
    idx_tup_fetch AS tuples_fetched
FROM pg_stat_user_indexes
WHERE indexname LIKE '%hnsw%'
ORDER BY idx_scan DESC;

-- ì¸ë±ìŠ¤ ë¸”ë¡œíŠ¸ ì²´í¬
SELECT
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS size,
    idx_scan,
    CASE
        WHEN idx_scan = 0 THEN 'Unused'
        WHEN idx_scan < 100 THEN 'Low Usage'
        ELSE 'Active'
    END AS status
FROM pg_stat_user_indexes
WHERE indexname LIKE '%hnsw%';
```

---

## ğŸ”„ 3. í–¥í›„ ê³„íš

### 3.1 ë‹¨ê¸° (1-2ì£¼)

#### HNSW íŒŒë¼ë¯¸í„° íŠœë‹ ì‹¤í—˜

```
ëª©í‘œ: ìµœì ì˜ ì„±ëŠ¥/ì •í™•ë„/ë©”ëª¨ë¦¬ ê· í˜•ì  ì°¾ê¸°

ì‹¤í—˜ ê³„íš:
1. m ê°’ ì‹¤í—˜ (8, 16, 32)
   â”œâ”€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •
   â”œâ”€ ê²€ìƒ‰ ì†ë„ ì¸¡ì •
   â””â”€ ì •í™•ë„(Recall) ì¸¡ì •

2. ef_construction ì‹¤í—˜ (32, 64, 128)
   â”œâ”€ ì¸ë±ìŠ¤ ë¹Œë“œ ì‹œê°„ ì¸¡ì •
   â”œâ”€ ì •í™•ë„ ì¸¡ì •
   â””â”€ ëŸ°íƒ€ì„ ì„±ëŠ¥ ì˜í–¥ í™•ì¸

3. ef_search ë™ì  ì¡°ì •
   â”œâ”€ API ìš”ì²­ë³„ ì •í™•ë„ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì¡°ì •
   â”œâ”€ ë¹ ë¥¸ ì‘ë‹µ: ef_search=40 (95% ì •í™•ë„)
   â””â”€ ë†’ì€ ì •í™•ë„: ef_search=100 (99% ì •í™•ë„)
```

#### ì¸ë±ìŠ¤ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•

```yaml
ë©”íŠ¸ë¦­:
  - ì¸ë±ìŠ¤ ì‚¬ìš© íšŸìˆ˜ (idx_scan)
  - í‰ê·  ê²€ìƒ‰ ì‹œê°„
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
  - ì •í™•ë„ (ìƒ˜í”Œë§ ê¸°ë°˜)

ì•Œë¦¼ ì¡°ê±´:
  - ê²€ìƒ‰ ì‹œê°„ > 50ms
  - ì •í™•ë„ < 95%
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ > 5GB
```

### 3.2 ì¤‘ê¸° (1-2ê°œì›”)

#### IVFFlat ì¸ë±ìŠ¤ì™€ì˜ í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ

```
ì‹œë‚˜ë¦¬ì˜¤ë³„ ì¸ë±ìŠ¤ ì„ íƒ:

ëŒ€ê·œëª¨ ë°°ì¹˜ ê²€ìƒ‰ (ì¼ê´„ ì²˜ë¦¬):
â”œâ”€ ì‚¬ìš©: IVFFlat
â”œâ”€ ì´ìœ : ë¹Œë“œ ë¹ ë¦„, ë©”ëª¨ë¦¬ ì ìŒ
â””â”€ ì •í™•ë„: 95% (í—ˆìš© ê°€ëŠ¥)

ì‹¤ì‹œê°„ API ê²€ìƒ‰:
â”œâ”€ ì‚¬ìš©: HNSW
â”œâ”€ ì´ìœ : ë¹ ë¥¸ ì‘ë‹µ, ë†’ì€ ì •í™•ë„
â””â”€ ë©”ëª¨ë¦¬: ì¶©ë¶„í•œ RAM í™•ë³´
```

#### ë²¡í„° ì••ì¶• ê¸°ë²• ë„ì…

```python
# Quantizationì„ í†µí•œ ë©”ëª¨ë¦¬ ì ˆê°
# 384d float32 (1,536 bytes) â†’ 384d int8 (384 bytes)
# ë©”ëª¨ë¦¬: 75% ì ˆê°, ì •í™•ë„: ~97% ìœ ì§€

# PQ (Product Quantization) ì ìš© ì‹œ:
# ë©”ëª¨ë¦¬: 90% ì ˆê°
# ì •í™•ë„: ~92% (Trade-off)
```

### 3.3 ì¥ê¸° (3-6ê°œì›”)

#### ë¶„ì‚° ë²¡í„° ê²€ìƒ‰ ì‹œìŠ¤í…œ

```
í˜„ì¬: PostgreSQL pgvector (ë‹¨ì¼ ì„œë²„)
ëª©í‘œ: Milvus/Weaviate (ë¶„ì‚° ë²¡í„° DB)

ì¥ì :
â”œâ”€ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥
â”œâ”€ ìƒ¤ë”©/íŒŒí‹°ì…”ë‹ ì§€ì›
â”œâ”€ GPU ê°€ì† ì§€ì›
â””â”€ 100M+ ë²¡í„° ì²˜ë¦¬ ê°€ëŠ¥

ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš:
1. PoC (Proof of Concept) êµ¬ì¶•
2. ì„±ëŠ¥ ë¹„êµ ë²¤ì¹˜ë§ˆí¬
3. ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
```

---

## ğŸ“ˆ 4. í†µê³„ ë° ë¶„ì„

### 4.1 ì»¤ë°‹ í†µê³„

```
2025-12-31  [be19a3d] feat(batch): DB ë§ˆì´ê·¸ë ˆì´ì…˜ V3, V4
            â”œâ”€ Files: 2 (new)
            â”‚  â”œâ”€ V3__fix_candidate_experience_years_constraint.sql
            â”‚  â””â”€ V4__add_hnsw_indexes.sql
            â”œâ”€ Lines: +172
            â””â”€ Impact:
                â”œâ”€ ì‹ ì… í›„ë³´ì ì§€ì› ê°€ëŠ¥
                â”œâ”€ ë²¡í„° ê²€ìƒ‰ 15-30ë°° í–¥ìƒ
                â””â”€ ë©”ëª¨ë¦¬ +2.8GB
```

### 4.2 ë°ì´í„°ë² ì´ìŠ¤ í˜„í™©

```sql
-- í…Œì´ë¸”ë³„ í†µê³„
SELECT
    schemaname,
    tablename,
    n_live_tup AS row_count,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size
FROM pg_stat_user_tables
WHERE tablename LIKE '%embedding%'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

**ê²°ê³¼:**

| í…Œì´ë¸” | í–‰ ìˆ˜ | ë°ì´í„° | ì¸ë±ìŠ¤ | ì „ì²´ |
|-------|------|--------|--------|------|
| candidate_skills_embedding | 118,741 | 363 MB | 1.5 GB | 1.86 GB |
| recruit_skills_embedding | 87,488 | 268 MB | 1.2 GB | 1.47 GB |
| skill_embedding_dic | 105 | 320 KB | 1.8 MB | 2.12 MB |
| **Total** | **206,334** | **631 MB** | **2.7 GB** | **3.33 GB** |

---

## ğŸ“ 5. ê²°ë¡ 

### ì£¼ìš” ì„±ê³¼

1. **ë°ì´í„° í’ˆì§ˆ ê°œì„ **
   - âœ… ì‹ ì… í›„ë³´ì ì§€ì› ê°€ëŠ¥ (experience_years >= 0)
   - âœ… ë°ì´í„° ë¬´ê²°ì„± ìœ ì§€

2. **ê²€ìƒ‰ ì„±ëŠ¥ í˜ì‹ **
   - âœ… ë²¡í„° ê²€ìƒ‰ 15-30ë°° í–¥ìƒ
   - âœ… 99%+ ì •í™•ë„ ë‹¬ì„±
   - âœ… ì‹¤ì‹œê°„ ê²€ìƒ‰ ê°€ëŠ¥ (15-20ms)

3. **ì¸í”„ë¼ ì•ˆì •ì„±**
   - âœ… Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ê³„ í™•ë¦½
   - âœ… HNSW ì¸ë±ìŠ¤ ìë™ ìœ ì§€ë³´ìˆ˜ ì „ëµ ìˆ˜ë¦½

### ê¸°ìˆ ì  ë„ì „

- **ë©”ëª¨ë¦¬ ì¦ê°€:** ì¸ë±ìŠ¤ë¡œ ì¸í•œ 2.8GB ì¶”ê°€ ì‚¬ìš© (ëª¨ë‹ˆí„°ë§ í•„ìš”)
- **íŒŒë¼ë¯¸í„° íŠœë‹:** ìµœì ì˜ m, ef_construction ê°’ ì°¾ê¸° (ì‹¤í—˜ ê³„íš ìˆ˜ë¦½)
- **ì¬ì¸ë±ì‹± ì „ëµ:** ëŒ€ëŸ‰ ë°ì´í„° ì‚½ì… ì‹œ ì¸ë±ìŠ¤ ì¬êµ¬ì¶• ìë™í™” í•„ìš”

### ë‹¤ìŒ ë‹¨ê³„

1. **ë‹¨ê¸°:** HNSW íŒŒë¼ë¯¸í„° íŠœë‹ ì‹¤í—˜ ì§„í–‰
2. **ì¤‘ê¸°:** í•˜ì´ë¸Œë¦¬ë“œ ì¸ë±ìŠ¤ ì „ëµ ìˆ˜ë¦½ (HNSW + IVFFlat)
3. **ì¥ê¸°:** ë¶„ì‚° ë²¡í„° DB ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€í†  (Milvus/Weaviate)

---

**ë³´ê³ ì„œ ì¢…ë£Œ**
**ì‘ì„±ì:** Batch-Server Team
**ë¬¸ì˜:** Backend Development Team
**ë²„ì „:** 1.0.0
**ìƒì„±ì¼:** 2026-01-05
