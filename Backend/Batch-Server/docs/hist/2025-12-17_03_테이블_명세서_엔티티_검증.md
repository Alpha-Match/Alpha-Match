# Batch Server - 테이블 명세서와 엔티티 불일치 검증

**날짜:** 2025-12-17
**작업 범위:** DB 스키마 가이드와 도메인 엔티티 간 일치성 검증

---

## 배경

사용자가 테이블 명세서와 `/Backend/Batch-Server/src/main/java/com/alpha/backend/domain/` 하위 엔티티들 간 불일치 가능성을 지적했습니다.

**검증 대상:**
- **DB 스키마 가이드**: `/Backend/docs/DB_스키마_가이드.md` (625 lines)
- **엔티티 파일**: 12개 Entity 클래스

---

## 검증 방법

### 1. 체계적 비교 프로세스

각 테이블에 대해 다음 항목을 검증:
1. **컬럼명 일치** - DB 스키마 vs Entity 필드 매핑
2. **타입 일치** - SQL 타입 vs Java 타입
3. **제약조건** - NOT NULL, PK, FK, CHECK, DEFAULT
4. **누락 필드** - DB에는 있으나 Entity에 없거나, 그 반대

### 2. 검증 대상 테이블 (8개)

1. dlq
2. checkpoint
3. recruit_metadata
4. recruit_embedding
5. skill_embedding_dic
6. candidate
7. candidate_skill
8. candidate_skills_embedding

---

## 검증 결과

### 1. ✅ recruit_metadata (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| id | UUID, PK | UUID id | @Column(name="id") | ✅ |
| company_name | TEXT, NOT NULL | String companyName | @Column(name="company_name", columnDefinition="TEXT") | ✅ |
| exp_years | INTEGER, NOT NULL, CHECK(>=0) | Integer expYears | @Column(name="exp_years", nullable=false) | ✅ |
| english_level | TEXT, CHECK(ENUM) | String englishLevel | @Column(name="english_level", columnDefinition="TEXT") | ✅ |
| primary_keyword | TEXT | String primaryKeyword | @Column(name="primary_keyword", columnDefinition="TEXT") | ✅ |
| created_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime createdAt | BaseMetadataEntity 상속 | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | BaseMetadataEntity 상속 | ✅ |

**결론:** 완전 일치 ✅

---

### 2. ✅ recruit_embedding (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| id | UUID, PK, FK → recruit_metadata | UUID id | @Column(name="id") | ✅ |
| vector | VECTOR(384), NOT NULL | PGvector vector | BaseEmbeddingEntity 상속 | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | BaseEmbeddingEntity 상속 | ✅ |

**결론:** 완전 일치 ✅

---

### 3. ✅ skill_embedding_dic (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| skill | VARCHAR(50), PK | String skill | @Id, @Column(name="skill", length=50) | ✅ |
| position_category | VARCHAR(50), NOT NULL | String positionCategory | @Column(name="position_category", length=50, nullable=false) | ✅ |
| skill_vector | VECTOR(768), NOT NULL | PGvector skillVector | @Column(name="skill_vector", nullable=false) | ✅ |
| created_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime createdAt | @CreationTimestamp | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | @UpdateTimestamp | ✅ |

**결론:** 완전 일치 ✅

---

### 4. ✅ candidate (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| candidate_id | UUID, PK | UUID id | @AttributeOverride(name="id", column=@Column(name="candidate_id")) | ✅ |
| position_category | VARCHAR(50), NOT NULL | String positionCategory | @Column(name="position_category", nullable=false, length=50) | ✅ |
| experience_years | INTEGER, NOT NULL, DEFAULT 0, CHECK(>=0) | Integer experienceYears | @Column(name="experience_years", nullable=false), @Builder.Default = 0 | ✅ |
| original_resume | TEXT, NOT NULL | String originalResume | @Column(name="original_resume", nullable=false, columnDefinition="TEXT") | ✅ |
| created_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime createdAt | BaseMetadataEntity 상속 | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | BaseMetadataEntity 상속 | ✅ |

**결론:** 완전 일치 ✅

---

### 5. ✅ candidate_skill (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| candidate_id | UUID, PK, FK → candidate | UUID candidateId | @Id, @Column(name="candidate_id", columnDefinition="UUID") | ✅ |
| skill | VARCHAR(50), PK, FK → skill_embedding_dic | String skill | @Id, @Column(name="skill", length=50) | ✅ |
| created_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime createdAt | @CreationTimestamp | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | @UpdateTimestamp | ✅ |

**복합 PK:** @IdClass(CandidateSkillId.class) ✅

**결론:** 완전 일치 ✅

---

### 6. ✅ candidate_skills_embedding (일치)

| 컬럼명 | DB 타입 | Entity 필드 | 매핑 | 상태 |
|--------|---------|------------|------|------|
| candidate_id | UUID, PK, FK → candidate | UUID id | @AttributeOverride(name="id", column=@Column(name="candidate_id")) | ✅ |
| skills | VARCHAR(50)[], NOT NULL | String[] skills | @Column(name="skills", columnDefinition="VARCHAR(50)[]", nullable=false) | ✅ |
| skills_vector | VECTOR(768), NOT NULL | PGvector vector | @AttributeOverride(name="vector", column=@Column(name="skills_vector")) | ✅ |
| created_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime createdAt | @CreationTimestamp | ✅ |
| updated_at | TIMESTAMP, NOT NULL, DEFAULT NOW() | LocalDateTime updatedAt | BaseEmbeddingEntity 상속 | ✅ |

**결론:** 완전 일치 ✅

---

### 7. ⚠️ dlq (불일치 발견)

**DB 스키마 가이드 (line 307-333):**

| 컬럼명 | DB 타입 | 제약 | 설명 |
|--------|---------|------|------|
| id | BIGSERIAL | PK | DLQ 레코드 ID (자동 증가) |
| domain | VARCHAR(50) | NOT NULL, CHECK(IN 'recruit','candidate') | 도메인 구분 |
| **failed_id** | UUID | | 실패한 엔티티의 UUID |
| error_message | TEXT | NOT NULL | 에러 메시지 |
| payload | JSONB | | 실패한 데이터 (JSON) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 실패 시간 |

**Entity (DlqEntity.java, line 37-38):**
```java
@Column(name = "entity_id", columnDefinition = "UUID")
private UUID entityId;
```

**❌ 불일치 사항:**
- **DB 스키마 문서**: `failed_id` (line 311)
- **Entity 매핑**: `entity_id` (line 37)

**영향도:**
- 현재 Entity는 `entity_id` 컬럼으로 매핑되어 있음
- DB 스키마 가이드 문서가 잘못 작성되었거나, 실제 DB 테이블 정의가 잘못되었을 가능성

**원인 분석:**
- DB 스키마 가이드 line 311: `| failed_id | UUID | | 실패한 엔티티의 UUID |`
- 하지만 Entity는 line 18-20에서 인덱스를 정의: `@Index(name = "idx_dlq_entity_id", columnList = "entity_id")`
- 인덱스 이름이 `entity_id`를 참조하므로 Entity가 정확하고, **DB 스키마 가이드가 잘못됨**

**Flyway 마이그레이션 검증 결과:**
```sql
-- V1__init_database_schema.sql (line 140-148)
CREATE TABLE dlq (
    id BIGSERIAL NOT NULL,
    domain VARCHAR(50) NOT NULL,
    failed_id UUID,                    -- ✅ 실제 DB는 failed_id
    error_message TEXT NOT NULL,
    payload TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    PRIMARY KEY (id)
);
```

**❌ 심각한 불일치:**
- **Flyway SQL (실제 DB):** `failed_id` ✅
- **Entity:** `entity_id` ❌ **← 런타임 에러 발생 가능!**
- **DB 스키마 가이드:** `failed_id` ✅

**영향도:**
- **심각도:** HIGH (런타임 에러)
- **증상:** Entity 저장 시 `column "entity_id" does not exist` 에러 발생 가능
- **조치:** DlqEntity.java 수정 필요 (entity_id → failed_id)

---

### 8. ❌ checkpoint (심각한 불일치)

#### 불일치 1: ERD vs 테이블 명세

**ERD 다이어그램 (line 105-113):**
```
┌─────────────────────────────┐
│   checkpoint (공통)         │
├─────────────────────────────┤
│ id (BIGSERIAL) PK           │
│ domain (VARCHAR) UNIQUE     │
│ last_processed_uuid (UUID)  │
│ processed_count (BIGINT)    │
│ updated_at (TIMESTAMP)      │
└─────────────────────────────┘
```

**테이블 상세 (line 342-345):**

| 컬럼명 | 타입 | 제약 | 설명 |
|--------|------|------|------|
| domain | VARCHAR(50) | PK, CHECK(IN 'recruit','candidate') | 도메인 구분 (PK) |
| last_processed_uuid | UUID | | 마지막 처리된 UUID |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 마지막 업데이트 시간 |

**Entity (CheckpointEntity.java):**
```java
@Id
@Column(name = "domain", length = 50, nullable = false)
private String domain;  // PK

@Column(name = "last_processed_uuid", columnDefinition = "UUID")
private UUID lastProcessedUuid;

@UpdateTimestamp
@Column(name = "updated_at", nullable = false)
private LocalDateTime updatedAt;
```

**Flyway 마이그레이션 검증 결과:**
```sql
-- V1__init_database_schema.sql (line 158-165)
CREATE TABLE checkpoint (
    id BIGSERIAL NOT NULL,             -- ✅ id가 PK
    domain VARCHAR(50) NOT NULL UNIQUE, -- ✅ domain은 UNIQUE (PK 아님)
    last_processed_uuid UUID,
    processed_count BIGINT NOT NULL DEFAULT 0, -- ✅ processed_count 포함
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    PRIMARY KEY (id)
);
```

**❌ 심각한 불일치:**

1. **Primary Key 구조**:
   - **Flyway SQL (실제 DB):** `id (BIGSERIAL) PK`, `domain (UNIQUE)` ✅
   - **ERD 다이어그램**: `id (BIGSERIAL) PK`, `domain (UNIQUE)` ✅
   - **테이블 상세 명세**: `domain PK` (no id field) ❌
   - **Entity**: `domain PK` (no id field) ❌ **← 런타임 에러 발생 가능!**

2. **processed_count 컬럼**:
   - **Flyway SQL (실제 DB):** `processed_count BIGINT` ✅
   - **ERD 다이어그램**: `processed_count (BIGINT)` ✅
   - **테이블 상세 명세**: `processed_count` 없음 ❌
   - **Entity**: `processed_count` 없음 ❌

**영향도:**
- **심각도:** CRITICAL (Entity 구조 완전 불일치)
- **증상:**
  - Entity 저장 시 `column "domain" is not primary key` 에러
  - `id` 컬럼 누락으로 레코드 식별 불가
  - `processed_count` 누락으로 통계 기능 동작 불가
- **조치:**
  1. CheckpointEntity.java 수정 (id PK 추가, domain UNIQUE로 변경, processed_count 추가)
  2. DB 스키마 가이드 테이블 상세 수정

**정확한 구조 (Flyway SQL 기준):**
```
┌─────────────────────────────┐
│   checkpoint (공통)         │
├─────────────────────────────┤
│ id (BIGSERIAL) PK           │
│ domain (VARCHAR(50)) UNIQUE │
│ last_processed_uuid (UUID)  │
│ processed_count (BIGINT)    │
│ updated_at (TIMESTAMP)      │
└─────────────────────────────┘
```

---

## 종합 요약

### ✅ 일치하는 테이블 (6개)

1. recruit_metadata ✅
2. recruit_embedding ✅
3. skill_embedding_dic ✅
4. candidate ✅
5. candidate_skill ✅
6. candidate_skills_embedding ✅

### ❌ 불일치하는 테이블 (2개 - 심각)

#### 1. dlq 테이블 (HIGH 우선순위)
- **문제**: Entity 컬럼명이 실제 DB와 불일치
- **Flyway SQL (실제 DB)**: `failed_id` ✅
- **DB 스키마 가이드**: `failed_id` ✅
- **Entity**: `entity_id` ❌ **← 수정 필요**
- **심각도**: HIGH (런타임 에러 발생 가능)
- **해결 방법**:
  1. DlqEntity.java 수정 (entity_id → failed_id)
  2. 인덱스 이름도 수정 (idx_dlq_entity_id → idx_dlq_failed_id)

#### 2. checkpoint 테이블 (CRITICAL 우선순위)
- **문제**: Entity 구조가 실제 DB와 완전히 불일치
- **Flyway SQL (실제 DB)**: `id (PK)`, `domain (UNIQUE)`, `processed_count` ✅
- **ERD 다이어그램**: `id (PK)`, `domain (UNIQUE)`, `processed_count` ✅
- **DB 스키마 가이드 (테이블 상세)**: `domain (PK)`, no id, no processed_count ❌
- **Entity**: `domain (PK)`, no id, no processed_count ❌ **← 수정 필요**
- **심각도**: CRITICAL (Entity 구조 완전 불일치)
- **해결 방법**:
  1. CheckpointEntity.java 수정 (id PK 추가, domain UNIQUE로 변경, processed_count 추가)
  2. DB 스키마 가이드 테이블 상세 수정

---

## 수정 필요 사항

### 1. DlqEntity.java 수정 (HIGH 우선순위)

#### 수정 위치: line 37-38

**현재:**
```java
@Column(name = "entity_id", columnDefinition = "UUID")
private UUID entityId;
```

**수정 후:**
```java
@Column(name = "failed_id", columnDefinition = "UUID")
private UUID failedId;
```

**추가 수정 (line 19):**
- 인덱스 이름 변경: `idx_dlq_entity_id` → `idx_dlq_failed_id`

**현재:**
```java
@Index(name = "idx_dlq_entity_id", columnList = "entity_id")
```

**수정 후:**
```java
@Index(name = "idx_dlq_failed_id", columnList = "failed_id")
```

**추가 수정 (line 53, 58):**
- Static factory method 파라미터명 변경

**현재 (line 53-60):**
```java
public static DlqEntity create(String domain, UUID entityId, String errorMessage, String payloadJson) {
    return DlqEntity.builder()
            .domain(domain)
            .entityId(entityId)  // ← 변경
            .errorMessage(errorMessage)
            .payload(payloadJson)
            .build();
}
```

**수정 후:**
```java
public static DlqEntity create(String domain, UUID failedId, String errorMessage, String payloadJson) {
    return DlqEntity.builder()
            .domain(domain)
            .failedId(failedId)  // ← 변경
            .errorMessage(errorMessage)
            .payload(payloadJson)
            .build();
}
```

---

### 2. CheckpointEntity.java 수정 (CRITICAL 우선순위)

#### 완전 재작성 필요

**현재 (line 26-35):**
```java
@Id
@Column(name = "domain", length = 50, nullable = false)
private String domain;  // PK

@Column(name = "last_processed_uuid", columnDefinition = "UUID")
private UUID lastProcessedUuid;

@UpdateTimestamp
@Column(name = "updated_at", nullable = false)
private LocalDateTime updatedAt;
```

**수정 후:**
```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
@Column(name = "id")
private Long id;  // ← NEW: PK

@Column(name = "domain", length = 50, nullable = false, unique = true)
private String domain;  // ← CHANGED: UNIQUE (not PK)

@Column(name = "last_processed_uuid", columnDefinition = "UUID")
private UUID lastProcessedUuid;

@Column(name = "processed_count", nullable = false)
private Long processedCount = 0L;  // ← NEW: 처리된 레코드 수

@UpdateTimestamp
@Column(name = "updated_at", nullable = false)
private LocalDateTime updatedAt;
```

**추가 수정 (line 40-42):**
- updateCheckpoint 메서드 수정

**현재:**
```java
public void updateCheckpoint(UUID uuid) {
    this.lastProcessedUuid = uuid;
}
```

**수정 후:**
```java
public void updateCheckpoint(UUID uuid, long count) {
    this.lastProcessedUuid = uuid;
    this.processedCount = count;
}

public void incrementProcessedCount() {
    this.processedCount++;
}
```

---

### 3. DB_스키마_가이드.md 수정 (MEDIUM 우선순위)

#### 수정 1: checkpoint 테이블 상세 (line 342-345)

**현재:**
```markdown
| 컬럼명 | 타입 | 제약 | 설명 |
|--------|------|------|------|
| domain | VARCHAR(50) | PK, CHECK(IN 'recruit','candidate') | 도메인 구분 (PK) |
| last_processed_uuid | UUID | | 마지막 처리된 UUID |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 마지막 업데이트 시간 |
```

**수정 후:**
```markdown
| 컬럼명 | 타입 | 제약 | 설명 |
|--------|------|------|------|
| id | BIGSERIAL | PK | Checkpoint ID (자동 증가) |
| domain | VARCHAR(50) | NOT NULL, UNIQUE, CHECK(IN 'recruit','candidate') | 도메인 구분 |
| last_processed_uuid | UUID | | 마지막 처리된 UUID |
| processed_count | BIGINT | NOT NULL, DEFAULT 0 | 처리된 레코드 수 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 마지막 업데이트 시간 |
```

#### 수정 2: checkpoint 초기 데이터 (line 347-353)

**현재:**
```sql
INSERT INTO checkpoint (domain, last_processed_uuid, updated_at)
VALUES
    ('recruit', NULL, NOW()),
    ('candidate', NULL, NOW());
```

**수정 후:**
```sql
INSERT INTO checkpoint (domain, last_processed_uuid, processed_count, updated_at)
VALUES
    ('recruit', NULL, 0, NOW()),
    ('candidate', NULL, 0, NOW());
```

---

## 근본 원인 분석

### 1. 문서 간 불일치 발생 이유

#### dlq 테이블 (failed_id vs entity_id)
- **추정 원인**: 초기 설계 시 `failed_id`로 작성 → 구현 시 `entity_id`로 변경 → DB 스키마 가이드 미갱신
- **증거**:
  - Entity 코드에 `entity_id` 사용 (line 37)
  - 인덱스 이름: `idx_dlq_entity_id` (line 19)
  - DB 스키마 가이드만 `failed_id` 사용

#### checkpoint 테이블 (ERD vs 테이블 상세)
- **추정 원인**: 초기 ERD 설계 시 `id + processed_count` 포함 → 구현 시 단순화 (`domain` PK만) → ERD 미갱신
- **증거**:
  - Entity는 `domain` PK만 사용 (line 26-28)
  - 테이블 상세 명세도 `domain` PK만 명시 (line 343)
  - ERD만 `id + processed_count` 포함

### 2. 문서 동기화 실패 패턴

**발생 과정:**
1. 초기 설계: ERD 작성 (설계 의도)
2. 구현: 실제 코드 작성 시 설계 단순화
3. 문서화: 테이블 상세 작성 시 실제 코드 기준
4. **ERD 업데이트 누락** ← 문제 발생

**교훈:**
- ERD는 가장 먼저 작성되지만, 가장 늦게 업데이트되는 문서
- "Single Source of Truth"는 **실제 코드 (Entity + Flyway 마이그레이션)**
- 문서는 코드로부터 역으로 생성해야 정확성 보장

---

## 검증 도구 제안

### 1. 자동화된 스키마 검증 스크립트

**목적:** Entity와 Flyway SQL을 파싱하여 불일치 자동 탐지

**구현 예시 (Kotlin/Java):**
```kotlin
@Test
fun `Entity와 Flyway SQL 일치성 검증`() {
    val entities = scanEntities("com.alpha.backend.domain")
    val flywayDDL = parseFlywaySql("V1__init_database_schema.sql")

    entities.forEach { entity ->
        val tableName = entity.tableName
        val ddl = flywayDDL[tableName]

        entity.columns.forEach { column ->
            assertThat(ddl.hasColumn(column.name))
                .withFailMessage("Missing column ${column.name} in Flyway DDL")
                .isTrue()
        }
    }
}
```

### 2. 문서 생성 자동화

**목적:** Entity로부터 Markdown 테이블 자동 생성

**구현 예시:**
```kotlin
fun generateMarkdownTable(entity: Entity): String {
    return """
    | 컬럼명 | 타입 | 제약 | 설명 |
    |--------|------|------|------|
    ${entity.columns.joinToString("\n") { column ->
        "| ${column.name} | ${column.type} | ${column.constraints} | ${column.description} |"
    }}
    """.trimIndent()
}
```

---

## 다음 단계

### 1. 즉시 수정 (HIGH)
- [ ] DB_스키마_가이드.md 수정
  - [ ] dlq 테이블: `failed_id` → `entity_id`
  - [ ] checkpoint ERD: `id + processed_count` 제거

### 2. 검증 (MEDIUM)
- [ ] Flyway V1__init_database_schema.sql 파일 확인
  - [ ] dlq 테이블 DDL 확인 (`entity_id` vs `failed_id`)
  - [ ] checkpoint 테이블 DDL 확인 (PK 구조)
- [ ] 실제 DB 테이블 구조 확인 (PostgreSQL)
  ```sql
  \d dlq
  \d checkpoint
  ```

### 3. 재발 방지 (LOW)
- [ ] 테스트 코드 추가: Entity vs Flyway SQL 일치성 검증
- [ ] 문서화 프로세스 개선: 코드 → 문서 방향 강제
- [ ] CI/CD에 스키마 검증 추가

---

## 결론

### 검증 결과 요약
- **총 8개 테이블 검증**
- **6개 테이블 완전 일치** ✅ (recruit_metadata, recruit_embedding, skill_embedding_dic, candidate, candidate_skill, candidate_skills_embedding)
- **2개 테이블 심각한 불일치** ❌ (dlq, checkpoint)

### 불일치 유형 (Flyway SQL 검증 기준)

1. **dlq**: Entity 컬럼명 불일치
   - **Flyway SQL (실제 DB)**: `failed_id` ✅
   - **DB 스키마 가이드**: `failed_id` ✅
   - **Entity**: `entity_id` ❌ **← 코드 수정 필요**

2. **checkpoint**: Entity 구조 완전 불일치
   - **Flyway SQL (실제 DB)**: `id (PK)`, `domain (UNIQUE)`, `processed_count` ✅
   - **ERD 다이어그램**: `id (PK)`, `domain (UNIQUE)`, `processed_count` ✅
   - **DB 스키마 가이드 (테이블 상세)**: `domain (PK)`, no id, no processed_count ❌
   - **Entity**: `domain (PK)`, no id, no processed_count ❌ **← 코드 수정 필요**

### 영향도
- **심각도**: HIGH to CRITICAL
  - **dlq**: HIGH (런타임 시 컬럼 매핑 에러 발생 가능)
  - **checkpoint**: CRITICAL (PK 구조 완전 불일치, 데이터 무결성 위험)
- **긴급도**: URGENT (즉시 수정 필요)
- **영향 범위**:
  - DLQ 저장 실패 시 → 처리 실패 데이터 손실 위험
  - Checkpoint 저장/조회 실패 시 → Batch Job 재시작 불가

### 권장 조치 (우선순위 순)
1. **즉시 (CRITICAL)**: CheckpointEntity.java 완전 재작성
   - id PK 추가 (@GeneratedValue)
   - domain을 UNIQUE로 변경
   - processed_count 필드 추가
2. **즉시 (HIGH)**: DlqEntity.java 수정
   - entityId → failedId 변경
   - 인덱스 이름 변경
3. **단기 (MEDIUM)**: DB_스키마_가이드.md checkpoint 테이블 상세 수정
4. **중기**: 자동화된 스키마 검증 도구 도입 (Entity ↔ Flyway SQL)

---

**작업 완료일:** 2025-12-17
**다음 작업:** DB_스키마_가이드.md 수정
