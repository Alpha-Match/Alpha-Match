# Batch Server - 도메인별 제네릭 구조 구현 요약

**날짜:** 2025-12-12
**구현 범위:** Python 서버 구조에 맞춘 도메인별 프로세서 패턴

---

## 구현 내용

### 1. 핵심 아키텍처
```
Python Client Streaming → Batch gRPC Server → Domain Processor → DB
```

### 2. 구현된 클래스

#### 인터페이스 & 팩토리
- `DataProcessor<T>` - 도메인별 프로세서 인터페이스
- `DataProcessorFactory` - 프로세서 레지스트리 & 팩토리

#### DTO
- `RecruitRowDto` - Recruit 도메인 데이터
- `CandidateRowDto` - Candidate 도메인 (스켈레톤)

#### 프로세서 구현
- `RecruitDataProcessor` - JSON 파싱 + DB 저장 (완료)
- `CandidateDataProcessor` - 미구현 (UnsupportedOperationException)

#### gRPC 서버
- `EmbeddingStreamServiceImpl` - IngestDataStream RPC 구현

---

## 데이터 플로우

```
1. Python FastAPI: POST /data/ingest/recruit
2. Python gRPC Client → Batch gRPC Server
3. (첫 메시지) IngestMetadata: domain="recruit"
4. DataProcessorFactory.getProcessor("recruit")
5. RecruitDataProcessor 선택
6. (이후 메시지들) data_chunk 수신
7. Virtual Thread로 전환
8. processor.parseChunk(jsonChunk)
9. processor.saveToDatabase(dtos)
10. Metadata/Embedding 분리 → Upsert
```

---

## 로깅 포인트

### 프로세서 등록
```
[PROCESSOR_REGISTRY] Registered processor for domain: recruit
[PROCESSOR_REGISTRY] Total registered processors: 2
```

### 도메인 식별
```
[INGEST_METADATA] Domain: recruit | File: ... | Vector Dimension: 384
[PROCESSOR_SELECTED] Domain: recruit | Processor: RecruitDataProcessor
```

### 청크 처리
```
[INGEST] Domain: recruit | Chunk: 1 | Thread: VirtualThread[#123] |
         Rows: 100 | Times: parse=15ms, save=57ms, total=72ms
[SAVE] Last UUID: abc-123 | Last Company: 삼성전자
```

---

## 빌드 상태

```bash
./gradlew clean build -x test
# BUILD SUCCESSFUL in 25s
```

---

## 테스트 방법

```bash
# 1. Batch Server 실행
cd Backend/Batch-Server
./gradlew bootRun

# 2. Python Server 실행
cd Demo-Python
python src/main.py

# 3. 데이터 전송
curl -X POST "http://localhost:8000/data/ingest/recruit?file_name=processed_recruitment_data.pkl"
```

---

## 다음 단계

1. **통합 테스트**: Python → Batch 전체 플로우
2. **DLQ 처리**: 파싱/저장 실패 시 Dead Letter Queue
3. **Candidate 도메인**: 프로세서 구현
4. **캐시 무효화**: API Server 연동

---

**파일 위치:**
- 상세 문서: `/docs/도메인별_제네릭_구조_구현.md`
- 구현 파일: `/src/main/java/com/alpha/backend/application/processor/`
